---
title: Configuration
sidebarTitle: Configuration
description: Complete configuration reference for CodeCall plugin - modes, VM presets, embedding strategies, and per-tool metadata.
icon: gear
---

This page covers all configuration options for the CodeCall plugin, from quick presets to fine-grained control.

---

## Plugin Initialization

```ts
import { CodeCallPlugin } from '@frontmcp/plugins';

CodeCallPlugin.init({
  // Tool visibility mode
  mode: 'codecall_only' | 'codecall_opt_in' | 'metadata_driven',

  // VM/sandbox configuration
  vm: { /* ... */ },

  // Embedding/search configuration
  embedding: { /* ... */ },

  // Tool filtering
  includeTools: (tool) => boolean,

  // Direct invoke configuration
  directCalls: { /* ... */ },
});
```

---

## Tool Visibility Modes

Control which tools appear in `list_tools` vs. CodeCall.

### `codecall_only` (Recommended)

**Default mode.** Hides all tools from `list_tools`, exposes via CodeCall.

```ts
CodeCallPlugin.init({
  mode: 'codecall_only',
});
```

| Tool Location | Behavior |
|---------------|----------|
| `list_tools` | Only CodeCall meta-tools visible |
| CodeCall | All tools searchable and callable |
| Override | Set `visibleInListTools: true` per tool |

**Best for:** Large toolsets (20+), OpenAPI adapters, clean client experience.

### `codecall_opt_in`

Tools must explicitly opt into CodeCall. All tools visible in `list_tools` by default.

```ts
CodeCallPlugin.init({
  mode: 'codecall_opt_in',
});
```

| Tool Location | Behavior |
|---------------|----------|
| `list_tools` | All tools visible (default MCP behavior) |
| CodeCall | Only tools with `enabledInCodeCall: true` |

**Best for:** Gradual migration, mixed direct/CodeCall access.

### `metadata_driven`

Full control via per-tool metadata. No global assumptions.

```ts
CodeCallPlugin.init({
  mode: 'metadata_driven',
});
```

| Tool Location | Behavior |
|---------------|----------|
| `list_tools` | Based on `visibleInListTools` (default: true) |
| CodeCall | Based on `enabledInCodeCall` (default: false) |

**Best for:** Small toolsets, fine-grained control.

---

## Per-Tool Metadata

Control individual tool behavior with the `codecall` metadata field:

```ts
@Tool({
  name: 'users:list',
  description: 'List all users',
  codecall: {
    // Is this tool searchable and callable via CodeCall?
    enabledInCodeCall: true,  // default depends on mode

    // Is this tool visible in standard list_tools?
    visibleInListTools: false,  // default depends on mode

    // App ID for multi-app filtering (auto-detected if not set)
    appId: 'user-service',
  },
})
```

### Metadata by Mode

| Mode | `enabledInCodeCall` default | `visibleInListTools` default |
|------|----------------------------|------------------------------|
| `codecall_only` | `true` | `false` |
| `codecall_opt_in` | `false` | `true` |
| `metadata_driven` | `false` | `true` |

### Common Patterns

<AccordionGroup>
  <Accordion title="Hide from list_tools, available in CodeCall">
    ```ts
    codecall: {
      enabledInCodeCall: true,
      visibleInListTools: false,
    }
    ```
    Use for: Most tools in `codecall_only` mode.
  </Accordion>

  <Accordion title="Visible everywhere">
    ```ts
    codecall: {
      enabledInCodeCall: true,
      visibleInListTools: true,
    }
    ```
    Use for: Core tools that should be directly accessible AND in CodeCall.
  </Accordion>

  <Accordion title="Direct access only, no CodeCall">
    ```ts
    codecall: {
      enabledInCodeCall: false,
      visibleInListTools: true,
    }
    ```
    Use for: Admin tools, destructive operations, tools requiring human review.
  </Accordion>

  <Accordion title="CodeCall meta-tools only">
    ```ts
    codecall: {
      enabledInCodeCall: false,
      visibleInListTools: true,
    }
    ```
    Applied automatically to `codecall:search`, `codecall:describe`, etc.
  </Accordion>
</AccordionGroup>

---

## Global Tool Filtering

Filter tools globally with `includeTools`:

```ts
CodeCallPlugin.init({
  mode: 'codecall_only',

  // Only include tools matching this filter
  includeTools: (tool) => {
    // Exclude admin tools
    if (tool.name.startsWith('admin:')) return false;

    // Exclude destructive tools
    if (tool.metadata?.annotations?.destructiveHint) return false;

    // Include everything else
    return true;
  },
});
```

The filter receives a `ToolEntry` with:

```ts
interface ToolEntry {
  name: string;
  fullName: string;
  metadata?: {
    description?: string;
    annotations?: {
      destructiveHint?: boolean;
      idempotentHint?: boolean;
      readOnlyHint?: boolean;
    };
    codecall?: {
      enabledInCodeCall?: boolean;
      visibleInListTools?: boolean;
      appId?: string;
    };
  };
  owner?: { id: string };
}
```

---

## VM Configuration

Configure the JavaScript sandbox:

```ts
CodeCallPlugin.init({
  vm: {
    // Use a preset (recommended)
    preset: 'secure',

    // Or override individual settings
    timeoutMs: 5000,
    maxIterations: 10000,
    allowConsole: true,

    // Blocked identifiers (in addition to preset)
    disabledBuiltins: ['eval', 'Function'],
    disabledGlobals: ['process', 'require'],
  },
});
```

### VM Presets

| Preset | Timeout | Max Iterations | Console | Use Case |
|--------|---------|----------------|---------|----------|
| `locked_down` | 2s | 2,000 | No | Ultra-sensitive environments |
| `secure` | 3.5s | 5,000 | Yes | **Production default** |
| `balanced` | 5s | 10,000 | Yes | Complex workflows |
| `experimental` | 10s | 20,000 | Yes | Development only |

### Preset Details

<Tabs>
  <Tab title="locked_down">
    ```ts
    {
      preset: 'locked_down',
      timeoutMs: 2000,
      maxIterations: 2000,
      allowConsole: false,
      allowLoops: false,  // Only for-of allowed
      disabledBuiltins: ['eval', 'Function', 'AsyncFunction'],
      disabledGlobals: [
        'require', 'process', 'fetch',
        'setTimeout', 'setInterval', 'setImmediate',
        'global', 'globalThis'
      ],
    }
    ```
    **When to use:** Healthcare, finance, PII processing, compliance-heavy environments.
  </Tab>

  <Tab title="secure">
    ```ts
    {
      preset: 'secure',
      timeoutMs: 3500,
      maxIterations: 5000,
      allowConsole: true,
      allowLoops: false,  // Only for-of allowed
      disabledBuiltins: ['eval', 'Function', 'AsyncFunction'],
      disabledGlobals: [
        'require', 'process', 'fetch',
        'setTimeout', 'setInterval', 'setImmediate',
        'global', 'globalThis'
      ],
    }
    ```
    **When to use:** Most production deployments.
  </Tab>

  <Tab title="balanced">
    ```ts
    {
      preset: 'balanced',
      timeoutMs: 5000,
      maxIterations: 10000,
      allowConsole: true,
      allowLoops: true,  // for, for-of, while allowed
      disabledBuiltins: ['eval', 'Function', 'AsyncFunction'],
      disabledGlobals: ['require', 'process', 'fetch'],
    }
    ```
    **When to use:** Complex data processing, trusted model access.
  </Tab>

  <Tab title="experimental">
    ```ts
    {
      preset: 'experimental',
      timeoutMs: 10000,
      maxIterations: 20000,
      allowConsole: true,
      allowLoops: true,
      disabledBuiltins: ['eval', 'Function', 'AsyncFunction'],
      disabledGlobals: ['require', 'process'],
    }
    ```
    **When to use:** Development, testing, trusted internal tools.
  </Tab>
</Tabs>

---

## Embedding Configuration

Configure how tools are indexed for search:

```ts
CodeCallPlugin.init({
  embedding: {
    // Search strategy
    strategy: 'tfidf' | 'embedding',

    // TF-IDF specific
    similarityThreshold: 0.3,

    // Embedding specific (requires VectoriaDB)
    modelName: 'Xenova/all-MiniLM-L6-v2',
    cacheDir: './.cache/transformers',
  },
});
```

### Strategy Comparison

| Strategy | Speed | Relevance | Setup | Best For |
|----------|-------|-----------|-------|----------|
| `tfidf` | ⚡ Fast | Good | None | Most use cases, offline |
| `embedding` | Slower | Better | Model download | Large toolsets (100+) |

### TF-IDF Configuration

```ts
embedding: {
  strategy: 'tfidf',
  similarityThreshold: 0.3,  // Minimum score to include in results
}
```

TF-IDF extracts searchable text from:
- Tool name (tokenized: `users:list` → `users`, `list`)
- Description (weighted 3x)
- Key terms from description (4+ characters, no stop words)

### Embedding Configuration

```ts
embedding: {
  strategy: 'embedding',
  modelName: 'Xenova/all-MiniLM-L6-v2',  // Default
  cacheDir: './.cache/transformers',
  useHNSW: true,  // For large toolsets (1000+)
}
```

<Note>
  Embedding strategy uses [VectoriaDB](/docs/guides/vectoriadb) internally. The model (~22MB) is downloaded on first use and cached locally.
</Note>

---

## Direct Invocation

Configure the `codecall:invoke` meta-tool:

```ts
CodeCallPlugin.init({
  directCalls: {
    // Enable/disable codecall:invoke
    enabled: true,

    // Optional: restrict to specific tools
    allowedTools: ['users:getById', 'billing:getInvoice'],
  },
});
```

### When to Use Direct Invoke

| Use `codecall:invoke` | Use `codecall:execute` |
|-----------------------|------------------------|
| Single tool, no transformation | Multi-tool orchestration |
| Latency-critical paths | Data filtering/joining |
| Simple CRUD operations | Conditional logic |

---

## Complete Configuration Example

```ts
import { App } from '@frontmcp/sdk';
import { CodeCallPlugin } from '@frontmcp/plugins';

@App({
  id: 'my-app',
  plugins: [
    CodeCallPlugin.init({
      // Hide all tools, expose via CodeCall
      mode: 'codecall_only',

      // Filter out admin and destructive tools
      includeTools: (tool) => {
        if (tool.name.startsWith('admin:')) return false;
        if (tool.metadata?.annotations?.destructiveHint) return false;
        return true;
      },

      // Secure sandbox with custom timeout
      vm: {
        preset: 'secure',
        timeoutMs: 5000,  // 5 second timeout
        allowConsole: true,
      },

      // Fast TF-IDF search
      embedding: {
        strategy: 'tfidf',
        similarityThreshold: 0.25,
      },

      // Enable direct invocation for simple calls
      directCalls: {
        enabled: true,
        allowedTools: ['users:getById', 'health:ping'],
      },
    }),
  ],
})
export default class MyApp {}
```

---

## Environment Variables

Override configuration via environment variables:

| Variable | Overrides | Example |
|----------|-----------|---------|
| `CODECALL_VM_TIMEOUT` | `vm.timeoutMs` | `5000` |
| `CODECALL_VM_PRESET` | `vm.preset` | `secure` |
| `CODECALL_EMBEDDING_STRATEGY` | `embedding.strategy` | `tfidf` |
| `CODECALL_MODE` | `mode` | `codecall_only` |

```bash
CODECALL_VM_TIMEOUT=10000 CODECALL_MODE=codecall_opt_in npm start
```

---

## Migration Guide

### From Direct Tools to CodeCall

<Steps>
  <Step title="Add CodeCallPlugin">
    ```ts
    plugins: [
      CodeCallPlugin.init({ mode: 'metadata_driven' }),
    ]
    ```
  </Step>

  <Step title="Mark Tools for CodeCall">
    ```ts
    @Tool({
      codecall: { enabledInCodeCall: true, visibleInListTools: true },
    })
    ```
  </Step>

  <Step title="Test Both Access Methods">
    Verify tools work via both direct calls and CodeCall.
  </Step>

  <Step title="Switch to codecall_only">
    ```ts
    CodeCallPlugin.init({ mode: 'codecall_only' })
    ```
  </Step>

  <Step title="Remove Direct Visibility">
    ```ts
    codecall: { enabledInCodeCall: true, visibleInListTools: false }
    ```
  </Step>
</Steps>

---

## Related

<CardGroup cols={2}>
  <Card title="Security Model" icon="shield" href="/docs/plugins/codecall/security">
    Security implications of configuration choices
  </Card>
  <Card title="Production Scaling" icon="server" href="/docs/plugins/codecall/scaling">
    Performance tuning and monitoring
  </Card>
</CardGroup>
