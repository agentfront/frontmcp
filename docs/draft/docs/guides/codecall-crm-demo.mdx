---
title: CodeCall CRM Demo
slug: guides/codecall-crm-demo
icon: users-round
description: Explore the multi-tool CRM sample that showcases the CodeCall plugin in action.
---

FrontMCP ships a dedicated CRM showcase under `apps/e2e/demo-e2e-codecall`. It demonstrates how to put every customer workflow behind CodeCall: vector-backed search, describe, execute, CRUD tools, resources, prompts, and matching Jest suites.

<Info>
Source: `apps/e2e/demo-e2e-codecall`. The project includes a `pnpm nx serve demo-e2e-codecall` target for interactive exploration and `pnpm nx test demo-e2e-codecall` for automated validation.
</Info>

## Architecture overview

- **CodeCall-only surface** – `CodeCallPlugin.init({ mode: 'codecall_only', topK: 10 })` keeps the CRM tools discoverable via `codecall:search` and `codecall:describe` instead of dumping everything into the global tool list.
- **In-memory CRM store** – `crm.store.ts` seeds users and activities, exposes CRUD helpers, and powers the `users` resource plus analysis prompts.
- **Full tool catalog** – Eight tools ship with Zod schemas so CodeCall plans can CRUD users or log activities with strong typing.
- **Extra surfaces** – A `crm://users` resource and `analyze-user-activity` prompt make it easy to showcase CodeCall + prompts/resources in the same server.

## App and plugin wiring

```ts title="apps/e2e/demo-e2e-codecall/src/apps/crm/index.ts"
import { App } from '@frontmcp/sdk';
import { CodeCallPlugin } from '@frontmcp/plugins';
import UsersListTool from './tools/users-list.tool';
import UsersGetTool from './tools/users-get.tool';
import UsersCreateTool from './tools/users-create.tool';
import UsersUpdateTool from './tools/users-update.tool';
import UsersDeleteTool from './tools/users-delete.tool';
import ActivitiesListTool from './tools/activities-list.tool';
import ActivitiesLogTool from './tools/activities-log.tool';
import ActivitiesStatsTool from './tools/activities-stats.tool';
import UsersResource from './resources/users.resource';
import AnalyzeUserActivityPrompt from './prompts/analyze-user-activity.prompt';

@App({
  name: 'CRM',
  description: 'CRM application with CodeCall plugin for E2E testing',
  plugins: [
    CodeCallPlugin.init({
      mode: 'codecall_only',
      topK: 10,
    }),
  ],
  tools: [
    UsersListTool,
    UsersGetTool,
    UsersCreateTool,
    UsersUpdateTool,
    UsersDeleteTool,
    ActivitiesListTool,
    ActivitiesLogTool,
    ActivitiesStatsTool,
  ],
  resources: [UsersResource],
  prompts: [AnalyzeUserActivityPrompt],
})
export class CrmApp {}
```

## Tool catalog

| Tool               | Category   | Purpose                                                        |
| ------------------ | ---------- | -------------------------------------------------------------- |
| `users-list`       | Users      | Returns every seeded user with pagination-friendly metadata    |
| `users-get`        | Users      | Fetches a single profile by ID                                 |
| `users-create`     | Users      | Adds a new record with validation for email, company, and role |
| `users-update`     | Users      | Applies partial updates and reports success                    |
| `users-delete`     | Users      | Removes a user and returns human-friendly status text          |
| `activities-list`  | Activities | Lists activities globally or per user                          |
| `activities-log`   | Activities | Appends a new activity and timestamps login events             |
| `activities-stats` | Activities | Summarizes totals grouped by type and user                     |

Each tool extends `ToolContext`, so CodeCall receives consistent logging, auth info, and structured results.

## Data store, resource, and prompt

```ts title="apps/e2e/demo-e2e-codecall/src/apps/crm/data/crm.store.ts"
class CrmStore {
  private users = new Map<string, User>();
  private activities: Activity[] = [];

  constructor() {
    this.seedData();
  }

  listUsers(): User[] {
    return Array.from(this.users.values());
  }

  getActivityStats() {
    const byType: Record<string, number> = {};
    const byUser: Record<string, number> = {};
    this.activities.forEach((activity) => {
      byType[activity.type] = (byType[activity.type] || 0) + 1;
      byUser[activity.userId] = (byUser[activity.userId] || 0) + 1;
    });
    return { total: this.activities length, byType, byUser };
  }
}

export const crmStore = new CrmStore();
```

- `UsersResource` exposes `crm://users` so inspectors can list users without calling CodeCall.
- `AnalyzeUserActivityPrompt` renders a Markdown report that blends `crmStore.getActivityStats()` with filtered activities, perfect for demonstrating prompt outputs that leverage tool-side data.

## End-to-end tests

The Jest suite at `apps/e2e/demo-e2e-codecall/e2e/codecall.e2e.test.ts` validates search, describe, and execute flows plus the CRM tools themselves.

```ts
import { test, expect } from '@frontmcp/testing';

test.use({
  server: 'apps/e2e/demo-e2e-codecall/src/main.ts',
  publicMode: true,
});

test('executes users-list via CodeCall', async ({ mcp }) => {
  const result = await mcp.tools.call('codecall:execute', {
    script: `const data = await callTool('users-list', {}); return data;`,
  });
  expect(result).toBeSuccessful();
  expect(result).toHaveTextContent('John Doe');
});
```

<Info>The suite also asserts that the CodeCall meta-tools reply with relevance scores, matched queries, and schema descriptions so you can copy the expectations directly into your own regression tests.</Info>

## Run it locally

<Steps>
  <Step stepNumber={1} title="Install dependencies">
    ```bash
    pnpm install
    ```
  </Step>
  <Step stepNumber={2} title="Start the server">
    ```bash
    pnpm nx serve demo-e2e-codecall --port 3013
    ```
    The log prints a Streamable HTTP URL (for example `http://localhost:3013`).
  </Step>
  <Step stepNumber={3} title="Connect a client">
    Launch the MCP Inspector (`npx @modelcontextprotocol/inspector`) or your favorite IDE client and point it at the URL from the previous step.
  </Step>
  <Step stepNumber={4} title="Exercise CodeCall">
    Call `codecall:search`, `codecall:describe`, and `codecall:execute`. Try running:
    ```js
    const list = await callTool('codecall:search', { queries: ['list users'] });
    const describe = await callTool('codecall:describe', { toolNames: ['users-create'] });
    ```
  </Step>
  <Step stepNumber={5} title="Run the Jest suite">
    ```bash
    pnpm nx test demo-e2e-codecall
    ```
    The suite boots the server with `TestServer.startNx`, then validates search relevance, schema descriptions, resource reads, and CodeCall execution outputs.
  </Step>
</Steps>

<Tip>
Pair this demo with the [CodeCall configuration reference](/docs/plugins/codecall/configuration) to see how `mode: 'codecall_only'`, `topK`, and metadata filters influence the meta-tools.
</Tip>
