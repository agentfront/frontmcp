---
title: Runtime API Reference
sidebarTitle: Runtime
icon: gear
description: Complete API reference for the @frontmcp/ui runtime system, including template context, helper functions, MCP Bridge, and wrapper utilities.
---

## Template Context

### TemplateContext

Context passed to template builder functions.

```typescript
interface TemplateContext<In, Out> {
  /** The input arguments passed to the tool */
  input: In;

  /** The raw output returned by the tool's execute method */
  output: Out;

  /** The structured content parsed from the output */
  structuredContent?: unknown;

  /** Helper functions for template rendering */
  helpers: TemplateHelpers;
}
```

Usage in templates:

```typescript
const template: TemplateBuilderFn<WeatherInput, WeatherOutput> = (ctx) => {
  const { input, output, helpers } = ctx;

  return `
    <div class="p-4">
      <h1>${helpers.escapeHtml(input.location)}</h1>
      <p>Temperature: ${output.temperature}°F</p>
    </div>
  `;
};
```

---

## Template Helpers

### TemplateHelpers

Helper functions available in every template context.

```typescript
interface TemplateHelpers {
  escapeHtml: (value: unknown) => string;
  formatDate: (date: Date | string, format?: string) => string;
  formatCurrency: (amount: number, currency?: string) => string;
  uniqueId: (prefix?: string) => string;
  jsonEmbed: (data: unknown) => string;
}
```

### `escapeHtml(value)`

Escapes HTML special characters to prevent XSS attacks. Accepts any value, returning an empty string for `null`/`undefined` and stringifying non-string inputs before escaping.

```typescript
helpers.escapeHtml('<script>alert("xss")</script>');
// '&lt;script&gt;alert("xss")&lt;/script&gt;'

helpers.escapeHtml('Tom & Jerry');
// 'Tom &amp; Jerry'

helpers.escapeHtml(null);
// ''
```

| Character | Escaped  |
| --------- | -------- |
| `&`       | `&amp;`  |
| `<`       | `&lt;`   |
| `>`       | `&gt;`   |
| `"`       | `&quot;` |
| `'`       | `&#x27;` |

<Tip>
Import `escapeHtml` directly from `@frontmcp/ui` (or `@frontmcp/ui/utils`) if you need to sanitize strings outside of template helpers.
</Tip>

<Warning>
  Always use `escapeHtml` for user-provided content to prevent XSS vulnerabilities.
</Warning>

### `formatDate(date, format?)`

Formats a date for display.

```typescript
helpers.formatDate(new Date());        // "12/3/2024" (localized)
helpers.formatDate('2024-01-15');      // "1/15/2024"
helpers.formatDate(date, 'iso');       // "2024-01-15T00:00:00.000Z"
helpers.formatDate(date, 'time');      // "10:30:45 AM"
helpers.formatDate(date, 'datetime');  // "1/15/2024, 10:30:45 AM"
```

| Format       | Description             |
| ------------ | ----------------------- |
| (default)    | Localized date          |
| `'iso'`      | ISO 8601 format         |
| `'time'`     | Localized time          |
| `'datetime'` | Localized date and time |

### `formatCurrency(amount, currency?)`

Formats a number as currency.

```typescript
helpers.formatCurrency(1234.56);        // "$1,234.56"
helpers.formatCurrency(1234.56, 'EUR'); // "€1,234.56"
helpers.formatCurrency(1234.56, 'GBP'); // "£1,234.56"
helpers.formatCurrency(1234.56, 'JPY'); // "¥1,235"
```

### `uniqueId(prefix?)`

Generates a unique ID for DOM elements.

```typescript
helpers.uniqueId();          // "mcp-1-m3k2j1h"
helpers.uniqueId('btn');     // "btn-2-m3k2j1i"
helpers.uniqueId('modal');   // "modal-3-m3k2j1j"
```

IDs are guaranteed unique within a single template render.

### `jsonEmbed(data)`

Safely embeds JSON data in HTML, escaping characters that could break script tags.

```typescript
const data = { name: '</script><script>alert(1)</script>' };
helpers.jsonEmbed(data);
// '{"name":"\\u003c/script\\u003e\\u003cscript\\u003ealert(1)\\u003c/script\\u003e"}'
```

| Character | Escaped  |
| --------- | -------- |
| `<`       | `\u003c` |
| `>`       | `\u003e` |
| `&`       | `\u0026` |
| `'`       | `\u0027` |

```typescript
const html = `
  <script>
    const data = ${helpers.jsonEmbed(userData)};
  </script>
`;
```

### `createTemplateHelpers()`

Creates a new set of template helpers.

```typescript
import { createTemplateHelpers } from '@frontmcp/ui';

const helpers = createTemplateHelpers();
```

---

## MCP Bridge

The MCP Bridge (`window.mcpBridge`) provides a unified API for widget interactivity across platforms.

### MCPBridge Interface

```typescript
interface MCPBridge {
  /** Detected provider type */
  readonly provider: ProviderType;

  /** Call a tool on the MCP server */
  callTool(name: string, params: Record<string, unknown>): Promise<unknown>;

  /** Send a message to the chat interface */
  sendMessage(content: string): Promise<void>;

  /** Open an external link */
  openLink(url: string): Promise<void>;

  /** Get the tool input arguments */
  readonly toolInput: Record<string, unknown>;

  /** Get the tool output/result */
  readonly toolOutput: unknown;

  /** Get the structured content */
  readonly structuredContent: unknown;

  /** Get the current widget state */
  readonly widgetState: Record<string, unknown>;

  /** Set the widget state (persisted) */
  setWidgetState(state: Record<string, unknown>): void;

  /** Get the host context */
  readonly context: HostContext;

  /** Subscribe to host context changes */
  onContextChange(callback: (context: Partial<HostContext>) => void): () => void;

  /** Subscribe to tool result updates */
  onToolResult(callback: (result: unknown) => void): () => void;
}
```

### ProviderType

```typescript
type ProviderType = 'openai' | 'ext-apps' | 'claude' | 'unknown';
```

### HostContext

```typescript
interface HostContext {
  /** Current theme mode */
  theme: ThemeMode;

  /** Current display mode */
  displayMode: DisplayMode;

  /** Available display modes */
  availableDisplayModes?: DisplayMode[];

  /** Viewport dimensions */
  viewport?: {
    width: number;
    height: number;
    maxHeight?: number;
    maxWidth?: number;
  };

  /** BCP 47 locale code */
  locale?: string;

  /** IANA timezone */
  timeZone?: string;

  /** User agent string */
  userAgent?: string;

  /** Platform type */
  platform?: 'web' | 'desktop' | 'mobile';

  /** Device capabilities */
  deviceCapabilities?: {
    touch?: boolean;
    hover?: boolean;
  };

  /** Safe area insets (for mobile) */
  safeAreaInsets?: {
    top: number;
    right: number;
    bottom: number;
    left: number;
  };
}
```

### ThemeMode

```typescript
type ThemeMode = 'light' | 'dark' | 'system';
```

### DisplayMode

```typescript
type DisplayMode = 'inline' | 'fullscreen' | 'pip' | 'carousel';
```

---

## Widget Runtime

### `getMCPBridgeScript()`

Returns the MCP Bridge runtime script for injection into widgets.

```typescript
import { getMCPBridgeScript } from '@frontmcp/ui';

const script = getMCPBridgeScript();
// Returns the minified runtime script
```

### `isMCPBridgeSupported()`

Checks if MCP Bridge is supported in the current environment.

```typescript
import { isMCPBridgeSupported } from '@frontmcp/ui';

if (isMCPBridgeSupported()) {
  await window.mcpBridge.callTool('my_tool', {});
}
```

### `MCP_BRIDGE_RUNTIME`

The pre-built MCP Bridge runtime script as a `<script>` tag.

```typescript
import { MCP_BRIDGE_RUNTIME } from '@frontmcp/ui';

const html = `
  <head>
    ${MCP_BRIDGE_RUNTIME}
  </head>
`;
```

---

## Wrapper Functions

### `wrapToolUI(options)`

…
