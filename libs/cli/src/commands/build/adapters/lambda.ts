import { AdapterTemplate } from '../types';

/**
 * AWS Lambda adapter - serverless deployment on AWS Lambda.
 * Compiles to ESM and uses @codegenie/serverless-express to wrap the Express app.
 *
 * Prerequisites:
 *   npm install @codegenie/serverless-express
 *
 * @see https://github.com/codegenie/serverless-express
 */
export const lambdaAdapter: AdapterTemplate = {
  moduleFormat: 'esnext',

  getEntryTemplate: (mainModulePath: string) => `// Auto-generated AWS Lambda entry point
// Generated by: frontmcp build --adapter lambda
//
// IMPORTANT: This adapter requires @codegenie/serverless-express
// Install it with: npm install @codegenie/serverless-express
//
process.env.FRONTMCP_SERVERLESS = '1';

import '${mainModulePath}';
import { getServerlessHandlerAsync } from '@frontmcp/sdk';
import serverlessExpress from '@codegenie/serverless-express';

let serverlessExpressInstance = null;

async function setup() {
  const app = await getServerlessHandlerAsync();
  serverlessExpressInstance = serverlessExpress({ app });
}

export const handler = async (event, context) => {
  if (!serverlessExpressInstance) {
    await setup();
  }
  return serverlessExpressInstance(event, context);
};
`,

  // No config file - user manages serverless.yml, SAM template, or CDK
};
